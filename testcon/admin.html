<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç®¡ç†ç”»é¢ï¼ˆãƒ­ã‚°ç®¡ç†ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: sans-serif;
  padding: 10px;
}
h1 {
  font-size: 1.2em;
}
button {
  margin: 5px 0;
  padding: 8px 12px;
  font-size: 1em;
}
textarea {
  width: 100%;
  height: 260px;
  font-size: 12px;
  margin-top: 10px;
  white-space: pre;
}
.warn {
  color: red;
  font-weight: bold;
}
</style>
</head>

<body>

<h1>ğŸ“‹ è¦–è´ãƒ­ã‚° ç®¡ç†ç”»é¢ï¼ˆadmin.htmlï¼‰</h1>

<p class="warn">
â€» ã“ã®ãƒšãƒ¼ã‚¸ã¯ <b>kioskå¤–ã® Chrome</b> ã§ã®ã¿ä½¿ç”¨ã—ã¦ãã ã•ã„
</p>

<button onclick="loadLog()">â‘  ãƒ­ã‚°è¡¨ç¤º</button>
<button onclick="exportCSV()">â‘¡ CSV å‡ºåŠ›</button>
<button onclick="clearLog()">â‘¢ ãƒ­ã‚°å®Œå…¨æ¶ˆå»</button>

<textarea id="output" placeholder="ã“ã“ã«ãƒ­ã‚°å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™"></textarea>

<script>
//const LOG_KEY = "viewLog";   // â˜… kioskå´ã¨åŒã˜ã‚­ãƒ¼å
const LOG_KEY = "studyLogs";   // â˜… kioskå´ã¨åŒã˜ã‚­ãƒ¼å

function loadLog() {
  const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]");
  if (logs.length === 0) {
    output.value = "ãƒ­ã‚°ã¯ã‚ã‚Šã¾ã›ã‚“";
    return;
  }
  output.value = JSON.stringify(logs, null, 2);
}

function exportCSV() {
  const logs = JSON.parse(localStorage.getItem(LOG_KEY) || "[]");
  if (logs.length === 0) {
    alert("ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“");
    return;
  }

  const header = Object.keys(logs[0]).join(",");
  const rows = logs.map(l =>
    Object.values(l).map(v =>
      `"${String(v).replace(/"/g,'""')}"`
    ).join(",")
  );

  const csv = [header, ...rows].join("\n");
  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "view_log.csv";
  a.click();
}

function clearLog() {
  if (!confirm("ãƒ­ã‚°ã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ")) return;

  localStorage.removeItem(LOG_KEY);

  // å¿µæŠ¼ã—ï¼ˆkioskå¤–Chromeã§ã¯ç¢ºå®Ÿï¼‰
  localStorage.clear();

  output.value = "ãƒ­ã‚°ã‚’å®Œå…¨æ¶ˆå»ã—ã¾ã—ãŸ";
}
</script>

</body>
</html>
